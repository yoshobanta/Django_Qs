<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee List</title>
    <style>
        table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        h2 { color: #333; }
        .note { background: #ffffd0; padding: 10px; margin: 10px 0; border-left: 4px solid #ffa500; }
    </style>
</head>
<body>
    <h1>Difference: objects.all() vs select_related()</h1>

    <!-- Using .all() - N+1 Query Problem -->
    <h2>1. Using Emp.objects.all()</h2>
    <div class="note">
        <strong>N+1 Problem:</strong> 1 query for Emp + N extra queries for each related Dept and Mgr access.<br>
        If you have 10 employees, it makes ~21 queries!
    </div>
    <table>
        <tr>
            <th>Emp No</th>
            <th>Emp Name</th>
            <th>Job</th>
            <th>Manager</th>
            <th>Hire Date</th>
            <th>Salary</th>
            <th>Commission</th>
            <th>Department</th>
        </tr>
        {% for emp in qsleo_all %}
        <tr>
            <td>{{ emp.emp_no }}</td>
            <td>{{ emp.emp_name }}</td>
            <td>{{ emp.job }}</td>
            <td>{{ emp.mgr.emp_name|default:"-" }}</td>
            <td>{{ emp.hiredate }}</td>
            <td>{{ emp.sal }}</td>
            <td>{{ emp.comm|default:"-" }}</td>
            <td>{{ emp.dept_no.dept_name }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="8">No employees found.</td></tr>
        {% endfor %}
    </table>

    <!-- Using .select_related() - Optimized -->
    <h2>2. Using Emp.objects.select_related('dept_no', 'mgr')</h2>
    <div class="note">
        <strong>Optimized:</strong> Only 1 query with SQL JOINs! All related data fetched in one go.<br>
        Much faster and efficient for ForeignKey relationships.
    </div>
    <table>
        <tr>
            <th>Emp No</th>
            <th>Emp Name</th>
            <th>Job</th>
            <th>Manager</th>
            <th>Hire Date</th>
            <th>Salary</th>
            <th>Commission</th>
            <th>Department</th>
        </tr>
        {% for emp in qsleo_select %}
        <tr>
            <td>{{ emp.emp_no }}</td>
            <td>{{ emp.emp_name }}</td>
            <td>{{ emp.job }}</td>
            <td>{{ emp.mgr.emp_name|default:"-" }}</td>
            <td>{{ emp.hiredate }}</td>
            <td>{{ emp.sal }}</td>
            <td>{{ emp.comm|default:"-" }}</td>
            <td>{{ emp.dept_no.dept_name }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="8">No employees found.</td></tr>
        {% endfor %}
    </table>

    <h2>Summary</h2>
    <table>
        <tr><th>Method</th><th>Queries</th><th>Use Case</th></tr>
        <tr>
            <td><code>.objects.all()</code></td>
            <td>1 + N (for each FK access)</td>
            <td>When you don't need related data</td>
        </tr>
        <tr>
            <td><code>.select_related()</code></td>
            <td>1 (with JOINs)</td>
            <td>ForeignKey / OneToOne relations</td>
        </tr>
    </table>
</body>
</html>